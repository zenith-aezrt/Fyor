local FyorUI = {}

-- // SERVICES // --
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

local LocalPlayer = Players.LocalPlayer
local ConfigFile = "fyor_ui_manual_config.json"

-- // INITIAL SETUP // --
FyorUI.CurrentTheme = {
    Accent = Color3.fromRGB(0, 85, 185), 
    Background = Color3.fromRGB(15, 15, 15),
    Secondary = Color3.fromRGB(25, 25, 25),
    Text = Color3.fromRGB(240, 240, 240),
    Border = Color3.fromRGB(40, 40, 40)
}

FyorUI.Languages = {
    ["English"] = { Home = "Home", Main = "Main", Settings = "Settings", NotifyTitle = "System", NotifyDesc = "Fyor UI loaded." },
    ["Indonesia"] = { Home = "Beranda", Main = "Utama", Settings = "Pengaturan", NotifyTitle = "Sistem", NotifyDesc = "Fyor UI dimuat." }
}

FyorUI.CurrentLanguage = "English"
FyorUI.CurrentFont = Enum.Font.GothamMedium
FyorUI.ScreenGui = nil
FyorUI.Closed = false
FyorUI.Config = { 
    Language = "English",
    Toggles = {},
    Sliders = {},
    Dropdowns = {}
}

-- // UTILS // --
local function Tween(obj, info, goal)
    local t = TweenService:Create(obj, TweenInfo.new(info.Time or 0.3, info.Style or Enum.EasingStyle.Quart, info.Dir or Enum.EasingDirection.Out), goal)
    t:Play()
    return t
end

local function MakeDraggable(dragPart, mainFrame)
    local dragging, dragStart, startPos
    dragPart.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true; dragStart = input.Position; startPos = mainFrame.Position
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UserInputService.InputEnded:Connect(function(input) dragging = false end)
end

-- // LIBRARY METHODS // --
function FyorUI:GetText(key) 
    return (self.Languages[self.CurrentLanguage] and self.Languages[self.CurrentLanguage][key]) or key 
end

function FyorUI:Notify(data)
    if not self.ScreenGui then return end
    local title = data.Title or "Notification"
    local text = data.Text or ""
    local duration = data.Duration or 4
    
    local notifyHolder = self.ScreenGui:FindFirstChild("NotifyHolder") or Instance.new("Frame", self.ScreenGui)
    if notifyHolder.Name ~= "NotifyHolder" then
        notifyHolder.Name = "NotifyHolder"; notifyHolder.Size = UDim2.new(0, 300, 1, 0)
        notifyHolder.Position = UDim2.new(1, -310, 0, 0); notifyHolder.BackgroundTransparency = 1
        local layout = Instance.new("UIListLayout", notifyHolder); layout.VerticalAlignment = Enum.VerticalAlignment.Bottom; layout.Padding = UDim.new(0, 10)
        Instance.new("UIPadding", notifyHolder).PaddingBottom = UDim.new(0, 20)
    end
    
    local card = Instance.new("Frame", notifyHolder); card.Size = UDim2.new(1, 0, 0, 0); card.BackgroundColor3 = self.CurrentTheme.Secondary; card.ClipsDescendants = true; Instance.new("UICorner", card).CornerRadius = UDim.new(0, 10)
    Instance.new("UIStroke", card).Color = self.CurrentTheme.Accent
    
    local content = Instance.new("Frame", card); content.Size = UDim2.new(1, 0, 0, 70); content.BackgroundTransparency = 1
    local t = Instance.new("TextLabel", content); t.Text = title; t.Font = Enum.Font.GothamBold; t.TextColor3 = self.CurrentTheme.Text; t.TextSize = 14; t.Position = UDim2.new(0, 15, 0, 10); t.BackgroundTransparency = 1; t.TextXAlignment = "Left"
    local s = Instance.new("TextLabel", content); s.Text = text; s.Font = Enum.Font.Gotham; s.TextColor3 = self.CurrentTheme.Text; s.TextTransparency = 0.4; s.TextSize = 12; s.Position = UDim2.new(0, 15, 0, 30); s.Size = UDim2.new(1, -30, 0, 30); s.BackgroundTransparency = 1; s.TextXAlignment = "Left"; s.TextWrapped = true
    
    Tween(card, {Time = 0.5}, {Size = UDim2.new(1, 0, 0, 70)})
    task.delay(duration, function() if card then Tween(card, {Time = 0.5}, {Size = UDim2.new(1, 0, 0, 0)}); task.wait(0.5); card:Destroy() end end)
end

function FyorUI:CreateWindow(mainTitle)
    if not self.ScreenGui then self.ScreenGui = Instance.new("ScreenGui", CoreGui); self.ScreenGui.Name = "fyor_UI"; self.ScreenGui.ResetOnSpawn = false end
    
    local container = Instance.new("Frame", self.ScreenGui); container.Name = "UI_Container"; container.Size = UDim2.new(0, 520, 0, 380); container.Position = UDim2.new(0.5, -260, 0.5, -190); container.BackgroundTransparency = 1
    local main = Instance.new("Frame", container); main.Name = "MainFrame"; main.ClipsDescendants = true; main.Size = UDim2.new(1, 0, 1, 0); main.BackgroundColor3 = self.CurrentTheme.Background; Instance.new("UICorner", main).CornerRadius = UDim.new(0, 12); Instance.new("UIStroke", main).Color = self.CurrentTheme.Border
    
    -- Topbar & Sidebar Logic (Sama seperti sebelumnya)
    local sideBar = Instance.new("Frame", main); sideBar.Size = UDim2.new(0, 140, 1, -45); sideBar.Position = UDim2.new(0, 0, 0, 45); sideBar.BackgroundColor3 = self.CurrentTheme.Secondary; sideBar.BackgroundTransparency = 0.3
    local tabContainer = Instance.new("ScrollingFrame", sideBar); tabContainer.Size = UDim2.new(1, -10, 1, -115); tabContainer.Position = UDim2.new(0, 5, 0, 45); tabContainer.BackgroundTransparency = 1; tabContainer.ScrollBarThickness = 0; Instance.new("UIListLayout", tabContainer).Padding = UDim.new(0, 5)
    local contentArea = Instance.new("Frame", main); contentArea.Size = UDim2.new(1, -150, 1, -55); contentArea.Position = UDim2.new(0, 145, 0, 50); contentArea.BackgroundTransparency = 1

    local Window = { Tabs = {}, CurrentTab = nil }

    function Window:CreateTab(name, key)
        local btn = Instance.new("TextButton", tabContainer); btn.Size = UDim2.new(1, 0, 0, 32); btn.BackgroundTransparency = 1; btn.Text = name; btn.Font = FyorUI.CurrentFont; btn.TextColor3 = FyorUI.CurrentTheme.Text; Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
        local container_tab = Instance.new("ScrollingFrame", contentArea); container_tab.Size = UDim2.new(1, 0, 1, 0); container_tab.BackgroundTransparency = 1; container_tab.Visible = false; container_tab.ScrollBarThickness = 0; Instance.new("UIListLayout", container_tab).Padding = UDim.new(0, 8); container_tab.UIListLayout.HorizontalAlignment = "Center"
        
        local Tab = { Container = container_tab, Button = btn, Key = key }
        
        btn.MouseButton1Click:Connect(function()
            for _, t in pairs(Window.Tabs) do t.Container.Visible = false; t.Button.BackgroundTransparency = 1 end
            container_tab.Visible = true; btn.BackgroundTransparency = 0.9; Window.CurrentTab = Tab
        end)

        -- // ELEMENT: BUTTON // --
        function Tab:CreateButton(text, callback)
            local b = Instance.new("TextButton", container_tab); b.Size = UDim2.new(0.95, 0, 0, 35); b.BackgroundColor3 = FyorUI.CurrentTheme.Secondary; b.Text = text; b.TextColor3 = FyorUI.CurrentTheme.Text; b.Font = FyorUI.CurrentFont; b.TextSize = 13; Instance.new("UICorner", b).CornerRadius = UDim.new(0, 8)
            b.MouseButton1Click:Connect(function() pcall(callback) end)
        end

        -- // ELEMENT: SLIDER // --
        function Tab:CreateSlider(text, configKey, min, max, default, callback)
            local currentVal = FyorUI.Config.Sliders[configKey] or default
            local sFrame = Instance.new("Frame", container_tab); sFrame.Size = UDim2.new(0.95, 0, 0, 50); sFrame.BackgroundColor3 = FyorUI.CurrentTheme.Secondary; Instance.new("UICorner", sFrame).CornerRadius = UDim.new(0, 8)
            local lbl = Instance.new("TextLabel", sFrame); lbl.Name = "TitleLabel"; lbl.Text = text .. " : " .. currentVal; lbl.Position = UDim2.new(0, 15, 0, 8); lbl.Size = UDim2.new(1, -30, 0, 20); lbl.BackgroundTransparency = 1; lbl.Font = FyorUI.CurrentFont; lbl.TextColor3 = FyorUI.CurrentTheme.Text; lbl.TextXAlignment = "Left"
            
            local track = Instance.new("TextButton", sFrame); track.Size = UDim2.new(1, -30, 0, 4); track.Position = UDim2.new(0, 15, 0, 35); track.BackgroundColor3 = Color3.fromRGB(45,45,45); track.Text = ""
            local fill = Instance.new("Frame", track); fill.Size = UDim2.new((currentVal-min)/(max-min), 0, 1, 0); fill.BackgroundColor3 = FyorUI.CurrentTheme.Accent; Instance.new("UICorner", fill)
            
            local dragging = false
            local function move(input)
                local pos = math.clamp((input.Position.X - track.AbsolutePosition.X) / track.AbsoluteSize.X, 0, 1)
                local val = math.floor(min + (max - min) * pos)
                fill.Size = UDim2.new(pos, 0, 1, 0); lbl.Text = text .. " : " .. val
                FyorUI.Config.Sliders[configKey] = val
                pcall(callback, val)
            end
            track.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true; move(input) end end)
            UserInputService.InputChanged:Connect(function(input) if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then move(input) end end)
            UserInputService.InputEnded:Connect(function(input) dragging = false end)
            pcall(callback, currentVal)
        end

        -- // ELEMENT: DROPDOWN // --
        function Tab:CreateDropdown(text, configKey, options, callback)
            local expanded = false
            local current = FyorUI.Config.Dropdowns[configKey] or options[1]
            
            local dFrame = Instance.new("Frame", container_tab); dFrame.Size = UDim2.new(0.95, 0, 0, 40); dFrame.BackgroundColor3 = FyorUI.CurrentTheme.Secondary; dFrame.ClipsDescendants = true; Instance.new("UICorner", dFrame).CornerRadius = UDim.new(0, 8)
            local btn = Instance.new("TextButton", dFrame); btn.Size = UDim2.new(1, 0, 0, 40); btn.BackgroundTransparency = 1; btn.Text = ""
            local lbl = Instance.new("TextLabel", dFrame); lbl.Name = "TitleLabel"; lbl.Text = text .. " : " .. current; lbl.Size = UDim2.new(1, -40, 0, 40); lbl.Position = UDim2.new(0, 15, 0, 0); lbl.BackgroundTransparency = 1; lbl.TextColor3 = FyorUI.CurrentTheme.Text; lbl.Font = FyorUI.CurrentFont; lbl.TextXAlignment = "Left"
            local arrow = Instance.new("TextLabel", dFrame); arrow.Text = ">"; arrow.Size = UDim2.new(0, 40, 0, 40); arrow.Position = UDim2.new(1, -40, 0, 0); arrow.BackgroundTransparency = 1; arrow.TextColor3 = FyorUI.CurrentTheme.Text; arrow.Rotation = 90
            
            local optCont = Instance.new("Frame", dFrame); optCont.Size = UDim2.new(1, 0, 0, #options * 30); optCont.Position = UDim2.new(0, 0, 0, 40); optCont.BackgroundTransparency = 1
            local layout = Instance.new("UIListLayout", optCont)

            for _, opt in pairs(options) do
                local o = Instance.new("TextButton", optCont); o.Size = UDim2.new(1, 0, 0, 30); o.BackgroundTransparency = 1; o.Text = opt; o.TextColor3 = Color3.fromRGB(180,180,180); o.Font = FyorUI.CurrentFont; o.TextSize = 12
                o.MouseButton1Click:Connect(function()
                    current = opt; lbl.Text = text .. " : " .. opt; expanded = false
                    Tween(dFrame, {}, {Size = UDim2.new(0.95, 0, 0, 40)})
                    Tween(arrow, {}, {Rotation = 90})
                    FyorUI.Config.Dropdowns[configKey] = opt
                    pcall(callback, opt)
                end)
            end

            btn.MouseButton1Click:Connect(function()
                expanded = not expanded
                Tween(dFrame, {}, {Size = expanded and UDim2.new(0.95, 0, 0, 40 + (#options * 30)) or UDim2.new(0.95, 0, 0, 40)})
                Tween(arrow, {}, {Rotation = expanded and 270 or 90})
            end)
            pcall(callback, current)
        end

        table.insert(Window.Tabs, Tab)
        if #Window.Tabs == 1 then container_tab.Visible = true; btn.BackgroundTransparency = 0.9; Window.CurrentTab = Tab end
        return Tab
    end
    
    FyorUI:Notify({Title = "Fyor UI", Text = "Library fully loaded!"})
    return Window
end

return FyorUI


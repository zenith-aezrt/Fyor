--[[
    fyorUI Library v1.1.0 (Fixed & Enhanced)
    - Perbaikan Draggable (Topbar & Bottom Handle)
    - Perbaikan Sistem Tab (Konten muncul otomatis)
    - Penambahan Jam & Tanggal Real-time
    - Penambahan Handle Drag Visual "____________________"
--]]

local fyorUI = {}
fyorUI.__index = fyorUI

-- Services
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local Stats = game:GetService("Stats")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Theme Colors
local Theme = {
	Background = Color3.fromRGB(13, 13, 13),
	Secondary = Color3.fromRGB(20, 20, 20),
	Accent = Color3.fromRGB(0, 85, 185),
	Text = Color3.fromRGB(255, 255, 255),
	TextDark = Color3.fromRGB(160, 160, 160),
	Border = Color3.fromRGB(35, 35, 35)
}

-- Utility Functions
local function Create(class, props, children)
	local obj = Instance.new(class)
	for i, v in pairs(props) do obj[i] = v end
	if children then
		for _, child in pairs(children) do child.Parent = obj end
	end
	return obj
end

local function MakeDraggable(obj, dragHandle)
	local dragging, dragInput, dragStart, startPos
	dragHandle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = obj.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)
	dragHandle.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			obj.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

-- Notification Holder
local ScreenGui = Create("ScreenGui", {Name = "fyorUI_Container", IgnoreGuiInset = true, ResetOnSpawn = false, Parent = CoreGui})
local NotificationHolder = Create("Frame", {
	Name = "fyorNotifs",
	Size = UDim2.new(0, 300, 1, 0),
	Position = UDim2.new(1, -310, 0, 0),
	BackgroundTransparency = 1,
	Parent = ScreenGui
})
Create("UIListLayout", {Parent = NotificationHolder, VerticalAlignment = Enum.VerticalAlignment.Bottom, Padding = UDim.new(0, 10), SortOrder = Enum.SortOrder.LayoutOrder})

function fyorUI:Notify(title, desc, duration)
	duration = duration or 5
	local notif = Create("Frame", {Size = UDim2.new(1, 0, 0, 0), BackgroundColor3 = Theme.Secondary, ClipsDescendants = true, Parent = NotificationHolder}, {
		Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
		Create("UIStroke", {Color = Theme.Border, Thickness = 1}),
		Create("Frame", {Size = UDim2.new(0, 4, 1, 0), BackgroundColor3 = Theme.Accent, BorderSizePixel = 0}, {Create("UICorner", {CornerRadius = UDim.new(0, 8)})}),
		Create("TextLabel", {Text = title, Size = UDim2.new(1, -25, 0, 25), Position = UDim2.new(0, 15, 0, 5), Font = Enum.Font.GothamBold, TextSize = 14, TextColor3 = Theme.Text, BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left}),
		Create("TextLabel", {Text = desc, Size = UDim2.new(1, -25, 0, 35), Position = UDim2.new(0, 15, 0, 25), Font = Enum.Font.GothamMedium, TextSize = 12, TextColor3 = Theme.TextDark, BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left, TextWrapped = true})
	})
	TweenService:Create(notif, TweenInfo.new(0.5, Enum.EasingStyle.Quart), {Size = UDim2.new(1, 0, 0, 70)}):Play()
	task.delay(duration, function()
		local t = TweenService:Create(notif, TweenInfo.new(0.5, Enum.EasingStyle.Quart), {Position = UDim2.new(1.5, 0, 0, 0)})
		t:Play() t.Completed:Connect(function() notif:Destroy() end)
	end)
end

function fyorUI:CreateWindow(title)
	local isVisible = true
	
	-- Main Frame
	local Main = Create("Frame", {Name = "MainWindow", Size = UDim2.new(0, 650, 0, 420), Position = UDim2.new(0.5, -325, 0.5, -210), BackgroundColor3 = Theme.Background, Parent = ScreenGui}, {
		Create("UICorner", {CornerRadius = UDim.new(0, 12)}),
		Create("UIStroke", {Color = Theme.Border, Thickness = 1.5})
	})
	
	-- Topbar
	local Topbar = Create("Frame", {Size = UDim2.new(1, 0, 0, 50), BackgroundTransparency = 1, Parent = Main})
	MakeDraggable(Main, Topbar)

	Create("TextLabel", {Text = title, Font = Enum.Font.GothamBold, TextSize = 18, TextColor3 = Theme.Text, Position = UDim2.new(0, 20, 0, 0), Size = UDim2.new(0, 120, 1, 0), BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left, Parent = Topbar})
	
	-- FPS/Ping/Clock Monitor
	local Monitor = Create("TextLabel", {Size = UDim2.new(0, 350, 1, 0), Position = UDim2.new(1, -365, 0, 0), BackgroundTransparency = 1, Font = Enum.Font.GothamMedium, TextSize = 11, TextColor3 = Theme.TextDark, TextXAlignment = Enum.TextXAlignment.Right, Parent = Topbar})
	
	task.spawn(function()
		while task.wait(0.5) do
			local time = os.date("%H:%M:%S - %d/%m/%y")
			local fps = math.floor(Stats.WorkspaceStats.RealtimeFPS)
			local ping = math.floor(LocalPlayer:GetNetworkPing() * 1000)
			Monitor.Text = string.format("%s | FPS: %d | PING: %dms", time, fps, ping)
		end
	end)

	-- Sidebar
	local Sidebar = Create("Frame", {Size = UDim2.new(0, 190, 1, -50), Position = UDim2.new(0, 0, 0, 50), BackgroundColor3 = Theme.Secondary, Parent = Main}, {
		Create("UICorner", {CornerRadius = UDim.new(0, 12)})
	})
	
	local TabContainer = Create("ScrollingFrame", {Size = UDim2.new(1, 0, 1, -130), Position = UDim2.new(0, 0, 0, 50), BackgroundTransparency = 1, ScrollBarThickness = 0, Parent = Sidebar})
	Create("UIListLayout", {Parent = TabContainer, Padding = UDim.new(0, 5), HorizontalAlignment = Enum.HorizontalAlignment.Center})

	-- User Info Card
	local UserInfo = Create("Frame", {Size = UDim2.new(1, -20, 0, 55), Position = UDim2.new(0, 10, 1, -65), BackgroundColor3 = Theme.Background, Parent = Sidebar}, {
		Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
		Create("ImageLabel", {Size = UDim2.new(0, 35, 0, 35), Position = UDim2.new(0, 10, 0.5, -17), Image = Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420), BackgroundTransparency = 1, Parent = nil}, {Create("UICorner", {CornerRadius = UDim.new(1, 0)})}),
		Create("TextLabel", {Text = LocalPlayer.DisplayName, Size = UDim2.new(1, -55, 0, 15), Position = UDim2.new(0, 50, 0.25, 0), Font = Enum.Font.GothamBold, TextSize = 11, TextColor3 = Theme.Text, BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left}),
		Create("TextLabel", {Text = "fyorUI Premium", Size = UDim2.new(1, -55, 0, 15), Position = UDim2.new(0, 50, 0.55, 0), Font = Enum.Font.GothamMedium, TextSize = 9, TextColor3 = Theme.Accent, BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left})
	})
	UserInfo.ImageLabel.Parent = UserInfo -- Fix for children hierarchy

	-- Content Area
	local ContentArea = Create("Frame", {Size = UDim2.new(1, -205, 1, -75), Position = UDim2.new(0, 195, 0, 60), BackgroundTransparency = 1, Parent = Main})

	-- Bottom Drag Handle
	local BottomHandle = Create("TextLabel", {Size = UDim2.new(0, 200, 0, 20), Position = UDim2.new(0.5, -100, 1, -15), BackgroundTransparency = 1, Text = "____________________", Font = Enum.Font.GothamBold, TextColor3 = Theme.Border, Parent = Main})
	MakeDraggable(Main, BottomHandle)

	-- Toggle Button
	local ToggleBtn = Create("Frame", {Size = UDim2.new(0, 45, 0, 45), Position = UDim2.new(0, 30, 0, 30), BackgroundColor3 = Theme.Accent, Parent = ScreenGui}, {
		Create("UICorner", {CornerRadius = UDim.new(0, 10)}),
		Create("ImageLabel", {Size = UDim2.new(0, 24, 0, 24), Position = UDim2.new(0.5, -12, 0.5, -12), Image = "rbxassetid://6031068426", BackgroundTransparency = 1})
	})
	MakeDraggable(ToggleBtn, ToggleBtn)

	ToggleBtn.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			isVisible = not isVisible
			local targetSize = isVisible and UDim2.new(0, 650, 0, 420) or UDim2.new(0, 0, 0, 0)
			TweenService:Create(Main, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = targetSize}):Play()
			task.wait(isVisible and 0 or 0.5)
			Main.Visible = isVisible
		end
	end)

	local tabs = {}
	local firstTab = true

	function tabs:CreateTab(name)
		local TabBtn = Create("TextButton", {Text = name, Size = UDim2.new(0, 170, 0, 38), BackgroundColor3 = Theme.Background, BackgroundTransparency = 1, Font = Enum.Font.GothamMedium, TextSize = 13, TextColor3 = Theme.TextDark, AutoButtonColor = false, Parent = TabContainer}, {Create("UICorner", {CornerRadius = UDim.new(0, 8)})})
		local Page = Create("ScrollingFrame", {Size = UDim2.new(1, 0, 1, 0), BackgroundTransparency = 1, ScrollBarThickness = 2, ScrollBarImageColor3 = Theme.Accent, Visible = false, Parent = ContentArea})
		Create("UIListLayout", {Parent = Page, Padding = UDim.new(0, 10), HorizontalAlignment = Enum.HorizontalAlignment.Center})

		TabBtn.MouseButton1Click:Connect(function()
			for _, v in pairs(ContentArea:GetChildren()) do v.Visible = false end
			for _, v in pairs(TabContainer:GetChildren()) do if v:IsA("TextButton") then TweenService:Create(v, TweenInfo.new(0.3), {BackgroundTransparency = 1, TextColor3 = Theme.TextDark}):Play() end end
			Page.Visible = true
			TweenService:Create(TabBtn, TweenInfo.new(0.3), {BackgroundTransparency = 0, TextColor3 = Theme.Text}):Play()
		end)

		if firstTab then
			firstTab = false
			Page.Visible = true
			TabBtn.BackgroundTransparency = 0
			TabBtn.TextColor3 = Theme.Text
		end

		local elements = {}

		function elements:CreateButton(text, callback)
			local Btn = Create("TextButton", {Text = text, Size = UDim2.new(0, 420, 0, 42), BackgroundColor3 = Theme.Secondary, Font = Enum.Font.GothamMedium, TextSize = 14, TextColor3 = Theme.Text, AutoButtonColor = false, Parent = Page}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("UIStroke", {Color = Theme.Border, Thickness = 1})
			})
			Btn.MouseButton1Click:Connect(function()
				local t = TweenService:Create(Btn, TweenInfo.new(0.1), {BackgroundColor3 = Theme.Accent})
				t:Play() t.Completed:Connect(function() TweenService:Create(Btn, TweenInfo.new(0.1), {BackgroundColor3 = Theme.Secondary}):Play() end)
				callback()
			end)
		end

		function elements:CreateToggle(text, default, callback)
			local state = default
			local Toggle = Create("Frame", {Size = UDim2.new(0, 420, 0, 45), BackgroundColor3 = Theme.Secondary, Parent = Page}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("TextLabel", {Text = text, Size = UDim2.new(1, -60, 1, 0), Position = UDim2.new(0, 15, 0, 0), Font = Enum.Font.GothamMedium, TextSize = 14, TextColor3 = Theme.Text, BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left})
			})
			local Switch = Create("TextButton", {Size = UDim2.new(0, 42, 0, 22), Position = UDim2.new(1, -55, 0.5, -11), BackgroundColor3 = state and Theme.Accent or Color3.fromRGB(50,50,50), Text = "", AutoButtonColor = false, Parent = Toggle}, {Create("UICorner", {CornerRadius = UDim.new(1, 0)})})
			local Knob = Create("Frame", {Size = UDim2.new(0, 16, 0, 16), Position = state and UDim2.new(1, -20, 0.5, -8) or UDim2.new(0, 4, 0.5, -8), BackgroundColor3 = Color3.fromRGB(255,255,255), Parent = Switch}, {Create("UICorner", {CornerRadius = UDim.new(1, 0)})})
			
			Switch.MouseButton1Click:Connect(function()
				state = not state
				TweenService:Create(Switch, TweenInfo.new(0.3), {BackgroundColor3 = state and Theme.Accent or Color3.fromRGB(50,50,50)}):Play()
				TweenService:Create(Knob, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Position = state and UDim2.new(1, -20, 0.5, -8) or UDim2.new(0, 4, 0.5, -8)}):Play()
				callback(state)
			end)
		end

		function elements:CreateSlider(text, min, max, default, callback)
			local Slider = Create("Frame", {Size = UDim2.new(0, 420, 0, 65), BackgroundColor3 = Theme.Secondary, Parent = Page}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("TextLabel", {Text = text, Size = UDim2.new(0, 200, 0, 30), Position = UDim2.new(0, 15, 0, 5), Font = Enum.Font.GothamMedium, TextSize = 14, TextColor3 = Theme.Text, BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left}),
				Create("TextLabel", {Name = "Value", Text = tostring(default), Size = UDim2.new(0, 50, 0, 30), Position = UDim2.new(1, -65, 0, 5), Font = Enum.Font.GothamBold, TextSize = 14, TextColor3 = Theme.Accent, BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Right})
			})
			local Bar = Create("Frame", {Size = UDim2.new(1, -30, 0, 6), Position = UDim2.new(0, 15, 0, 45), BackgroundColor3 = Color3.fromRGB(45,45,45), Parent = Slider}, {
				Create("UICorner", {CornerRadius = UDim.new(1,0)}),
				Create("Frame", {Name = "Fill", Size = UDim2.new((default-min)/(max-min), 0, 1, 0), BackgroundColor3 = Theme.Accent}, {Create("UICorner", {CornerRadius = UDim.new(1,0)})})
			})
			
			local dragging = false
			local function move()
				local percent = math.clamp((Mouse.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
				local val = math.floor(min + (max - min) * percent)
				Slider.Value.Text = tostring(val)
				Bar.Fill.Size = UDim2.new(percent, 0, 1, 0)
				callback(val)
			end
			Bar.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true move() end end)
			UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
			UserInputService.InputChanged:Connect(function(i) if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then move() end end)
		end

		function elements:CreateDropdown(text, options, callback)
			local open = false
			local Drop = Create("Frame", {Size = UDim2.new(0, 420, 0, 45), BackgroundColor3 = Theme.Secondary, ClipsDescendants = true, Parent = Page}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("TextLabel", {Text = text, Size = UDim2.new(1, -50, 0, 45), Position = UDim2.new(0, 15, 0, 0), Font = Enum.Font.GothamMedium, TextSize = 14, TextColor3 = Theme.Text, BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left}),
				Create("ImageLabel", {Size = UDim2.new(0, 20, 0, 20), Position = UDim2.new(1, -35, 0, 12), Image = "rbxassetid://6034818372", BackgroundTransparency = 1})
			})
			local List = Create("Frame", {Size = UDim2.new(1, 0, 0, #options * 32), Position = UDim2.new(0, 0, 0, 45), BackgroundTransparency = 1, Parent = Drop})
			Create("UIListLayout", {Parent = List, Padding = UDim.new(0, 2)})

			for _, opt in pairs(options) do
				local o = Create("TextButton", {Text = opt, Size = UDim2.new(1, 0, 0, 30), BackgroundTransparency = 1, Font = Enum.Font.GothamMedium, TextSize = 12, TextColor3 = Theme.TextDark, Parent = List})
				o.MouseButton1Click:Connect(function()
					callback(opt) open = false
					TweenService:Create(Drop, TweenInfo.new(0.3), {Size = UDim2.new(0, 420, 0, 45)}):Play()
				end)
			end
			Drop.InputBegan:Connect(function(i)
				if i.UserInputType == Enum.UserInputType.MouseButton1 then
					open = not open
					TweenService:Create(Drop, TweenInfo.new(0.4, Enum.EasingStyle.Quart), {Size = open and UDim2.new(0, 420, 0, 45 + (#options * 32)) or UDim2.new(0, 420, 0, 45)}):Play()
				end
			end)
		end

		return elements
	end

	function Main:Unload()
		TweenService:Create(Main, TweenInfo.new(0.4, Enum.EasingStyle.Quart), {Position = UDim2.new(0.5, -325, 1, 50)}):Play()
		task.wait(0.4) ScreenGui:Destroy()
	end

	return tabs
end

--==================================================================================
-- CONTOH PENGGUNAAN fyorUI (Gunakan Loadstring jika sudah di-upload)
--==================================================================================

local Window = fyorUI:CreateWindow("fyorUI v1.1")
fyorUI:Notify("System", "Library loaded successfully with fixes!", 5)

-- Tab Utama
local MainTab = Window:CreateTab("Main")
MainTab:CreateButton("Rejoin Game", function()
	game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer)
end)

MainTab:CreateToggle("Auto Farm", false, function(v)
	print("Auto Farm: ", v)
end)

-- Tab Settings
local SettingsTab = Window:CreateTab("Settings")
SettingsTab:CreateSlider("Walkspeed", 16, 200, 16, function(v)
	LocalPlayer.Character.Humanoid.WalkSpeed = v
end)

SettingsTab:CreateDropdown("Teleport Players", {"Player1", "Player2", "Player3"}, function(v)
	fyorUI:Notify("Teleport", "Teleporting to " .. v)
end)

SettingsTab:CreateButton("Destroy UI", function()
	Window:Unload()
end)

return fyorUI


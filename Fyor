local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local Library = {}
Library.Themes = {
	Dark = {Accent = Color3.fromRGB(0, 170, 255), Background = Color3.fromRGB(20, 20, 30), Secondary = Color3.fromRGB(30, 30, 45), Text = Color3.fromRGB(255, 255, 255), Border = Color3.fromRGB(50, 50, 70)},
	Light = {Accent = Color3.fromRGB(0, 120, 215), Background = Color3.fromRGB(255, 255, 255), Secondary = Color3.fromRGB(240, 240, 245), Text = Color3.fromRGB(30, 30, 30), Border = Color3.fromRGB(200, 200, 200)},
	Purple = {Accent = Color3.fromRGB(170, 0, 255), Background = Color3.fromRGB(25, 15, 35), Secondary = Color3.fromRGB(40, 25, 55), Text = Color3.fromRGB(255, 255, 255), Border = Color3.fromRGB(80, 50, 100)},
	Ocean = {Accent = Color3.fromRGB(0, 200, 200), Background = Color3.fromRGB(10, 25, 40), Secondary = Color3.fromRGB(20, 40, 60), Text = Color3.fromRGB(255, 255, 255), Border = Color3.fromRGB(40, 80, 120)},
	Neon = {Accent = Color3.fromRGB(255, 20, 147), Background = Color3.fromRGB(10, 10, 20), Secondary = Color3.fromRGB(25, 25, 40), Text = Color3.fromRGB(255, 255, 255), Border = Color3.fromRGB(60, 60, 100)}
}

Library.CurrentTheme = Library.Themes.Dark
Library.CurrentFont = Enum.Font.GothamBold

local Fonts = {
	["Gotham"] = Enum.Font.Gotham,
	["GothamBold"] = Enum.Font.GothamBold,
	["SourceSans"] = Enum.Font.SourceSans,
	["SourceSansBold"] = Enum.Font.SourceSansBold,
	["Roboto"] = Enum.Font.Roboto,
	["Ubuntu"] = Enum.Font.Ubuntu
}

local function Create(class, props)
	local obj = Instance.new(class)
	for prop, val in pairs(props or {}) do
		if prop ~= "Parent" then
			obj[prop] = val
		end
	end
	if props and props.Parent then
		obj.Parent = props.Parent
	end
	return obj
end

local function ApplyTheme(obj)
	if obj:IsA("GuiObject") then
		if obj.Name == "Accent" or (obj:FindFirstChild("Accent") and obj.Accent:IsA("Frame")) then
			local accentObj = obj.Name == "Accent" and obj or obj.Accent
			accentObj.BackgroundColor3 = Library.CurrentTheme.Accent
		end
		if obj:IsA("Frame") or obj:IsA("ScrollingFrame") then
			if obj.Name ~= "Accent" then
				obj.BackgroundColor3 = Library.CurrentTheme.Background
			end
		end
		if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
			obj.TextColor3 = Library.CurrentTheme.Text
			obj.Font = Library.CurrentFont
		end
		if obj:FindFirstChildOfClass("UIStroke") then
			obj.UIStroke.Color = Library.CurrentTheme.Border
		end
		if obj:IsA("Frame") and obj.Name ~= "Accent" and not obj:FindFirstChild("Accent") then
			obj.BackgroundColor3 = Library.CurrentTheme.Secondary
		end
	end
	for _, child in ipairs(obj:GetDescendants()) do
		if child ~= obj then
			ApplyTheme(child)
		end
	end
end

local function Dragify(frame, handle)
	handle = handle or frame
	local dragging = false
	local dragInput, mousePos, framePos

	handle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			mousePos = input.Position
			framePos = frame.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	handle.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - mousePos
			TweenService:Create(frame, TweenInfo.new(0.15, Enum.EasingStyle.Sine), {Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)}):Play()
		end
	end)
end

function Library:CreateWindow(titleText)
	local windowGui = Create("ScreenGui", {Name = "FyorWindow", Parent = playerGui, ResetOnSpawn = false})
	local main = Create("Frame", {
		Name = "Main",
		Parent = windowGui,
		Size = UDim2.new(0, 600, 0, 450),
		Position = UDim2.new(0.5, -300, 0.5, -225),
		BackgroundColor3 = Library.CurrentTheme.Background,
		ClipsDescendants = true
	})
	Create("UICorner", {CornerRadius = UDim.new(0,12), Parent = main})
	Create("UIStroke", {Thickness = 1.5, Color = Library.CurrentTheme.Border, Parent = main})

	local titleBar = Create("Frame", {
		Name = "TitleBar",
		Parent = main,
		Size = UDim2.new(1,0,0,40),
		BackgroundColor3 = Library.CurrentTheme.Secondary
	})
	Create("UICorner", {CornerRadius = UDim.new(0,12), Parent = titleBar})

	local titleLabel = Create("TextLabel", {
		Parent = titleBar,
		Text = titleText,
		Font = Enum.Font.GothamBold,
		TextSize = 18,
		TextColor3 = Library.CurrentTheme.Text,
		BackgroundTransparency = 1,
		Size = UDim2.new(1,-80,1,0),
		TextXAlignment = Enum.TextXAlignment.Left,
		Position = UDim2.new(0,15,0,0)
	})

	local minimizeBtn = Create("TextButton", {
		Name = "Minimize",
		Parent = titleBar,
		Size = UDim2.new(0,30,0,30),
		Position = UDim2.new(1,-70,0,5),
		Text = "–",
		Font = Enum.Font.GothamBold,
		TextSize = 24,
		BackgroundTransparency = 1,
		TextColor3 = Library.CurrentTheme.Text
	})

	local closeBtn = Create("TextButton", {
		Name = "Close",
		Parent = titleBar,
		Size = UDim2.new(0,30,0,30),
		Position = UDim2.new(1,-35,0,5),
		Text = "X",
		Font = Enum.Font.GothamBold,
		TextSize = 20,
		BackgroundTransparency = 1,
		TextColor3 = Library.CurrentTheme.Text
	})

	local content = Create("Frame", {
		Name = "Content",
		Parent = main,
		Size = UDim2.new(1,0,1,-40),
		Position = UDim2.new(0,0,0,40),
		BackgroundTransparency = 1
	})

	local tabPanel = Create("Frame", {
		Name = "TabPanel",
		Parent = content,
		Size = UDim2.new(0,140,1,0),
		BackgroundColor3 = Library.CurrentTheme.Secondary
	})

	local tabContent = Create("ScrollingFrame", {
		Name = "TabContent",
		Parent = content,
		Size = UDim2.new(1,-140,1,0),
		Position = UDim2.new(0,140,0,0),
		BackgroundTransparency = 1,
		CanvasSize = UDim2.new(0,0,0,0),
		AutomaticCanvasSize = Enum.AutomaticSize.Y,
		ScrollBarThickness = 4,
		ScrollingDirection = Enum.ScrollingDirection.Y
	})
	Create("UIPadding", {PaddingLeft = UDim.new(0,10), PaddingRight = UDim.new(0,10), PaddingTop = UDim.new(0,10), PaddingBottom = UDim.new(0,10), Parent = tabContent})

	Dragify(main, titleBar)

	local minimized = false
	minimizeBtn.MouseButton1Click:Connect(function()
		minimized = not minimized
		TweenService:Create(main, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {Size = minimized and UDim2.new(0,600,0,40) or UDim2.new(0,600,0,450)}):Play()
		minimizeBtn.Text = minimized and "+" or "–"
	end)

	closeBtn.MouseButton1Click:Connect(function()
		TweenService:Create(main, TweenInfo.new(0.4, Enum.EasingStyle.Quart), {Size = UDim2.new(0,0,0,0), Position = UDim2.new(0.5,0,0.5,0)}):Play()
		task.delay(0.4, function() windowGui:Destroy() end)
	end)

	local tabs = {}
	local currentTab = nil

	function Library:AddTab(name)
		local tabBtn = Create("TextButton", {
			Parent = tabPanel,
			Size = UDim2.new(1,-10,0,40),
			Position = UDim2.new(0,5,0,#tabs*45 + 10),
			Text = name,
			Font = Enum.Font.Gotham,
			TextSize = 16,
			TextColor3 = Library.CurrentTheme.Text,
			BackgroundColor3 = Library.CurrentTheme.Secondary,
			AutoButtonColor = false
		})
		Create("UICorner", {CornerRadius = UDim.new(0,8), Parent = tabBtn})

		local container = Create("Frame", {
			Parent = tabContent,
			Size = UDim2.new(1,0,0,0),
			BackgroundTransparency = 1,
			Visible = false
		})
		Create("UIListLayout", {
			Parent = container,
			Padding = UDim.new(0,8),
			SortOrder = Enum.SortOrder.LayoutOrder,
			FillDirection = Enum.FillDirection.Vertical
		})

		local function selectTab()
			if currentTab and currentTab ~= container then
				currentTab.Visible = false
				for _, btn in ipairs(tabs) do
					btn.BackgroundColor3 = Library.CurrentTheme.Secondary
					btn.TextColor3 = Library.CurrentTheme.Text
				end
			end
			container.Visible = true
			tabBtn.BackgroundColor3 = Library.CurrentTheme.Accent
			tabBtn.TextColor3 = Color3.new(1,1,1)
			currentTab = container
		end

		tabBtn.MouseButton1Click:Connect(selectTab)

		table.insert(tabs, tabBtn)

		if #tabs == 1 then
			selectTab()
		end

		local tab = {}

		function tab:Button(text, callback)
			local btn = Create("TextButton", {
				Parent = container,
				Size = UDim2.new(1,0,0,40),
				Text = text,
				Font = Enum.Font.Gotham,
				TextSize = 16,
				TextColor3 = Library.CurrentTheme.Text,
				BackgroundColor3 = Library.CurrentTheme.Secondary
			})
			Create("UICorner", {CornerRadius = UDim.new(0,8), Parent = btn})
			Create("UIStroke", {Thickness = 1, Color = Library.CurrentTheme.Border, Parent = btn})

			btn.MouseEnter:Connect(function()
				TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Library.CurrentTheme.Accent}):Play()
			end)
			btn.MouseLeave:Connect(function()
				TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Library.CurrentTheme.Secondary}):Play()
			end)
			btn.MouseButton1Click:Connect(callback or function() end)
			return btn
		end

		function tab:Toggle(text, default, callback)
			local toggleFrame = Create("Frame", {
				Parent = container,
				Size = UDim2.new(1,0,0,40),
				BackgroundTransparency = 1
			})
			local label = Create("TextLabel", {
				Parent = toggleFrame,
				Size = UDim2.new(1,-60,1,0),
				Text = text,
				Font = Enum.Font.Gotham,
				TextSize = 16,
				TextColor3 = Library.CurrentTheme.Text,
				BackgroundTransparency = 1,
				TextXAlignment = Enum.TextXAlignment.Left,
				Position = UDim2.new(0,10,0,0)
			})
			local switch = Create("Frame", {
				Name = "Accent",
				Parent = toggleFrame,
				Size = UDim2.new(0,50,0,24),
				Position = UDim2.new(1,-60,0.5,-12),
				BackgroundColor3 = default and Library.CurrentTheme.Accent or Library.CurrentTheme.Secondary
			})
			Create("UICorner", {CornerRadius = UDim.new(1,0), Parent = switch})
			local knob = Create("Frame", {
				Parent = switch,
				Size = UDim2.new(0,20,0,20),
				Position = default and UDim2.new(1,-22,0.5,-10) or UDim2.new(0,2,0.5,-10),
				BackgroundColor3 = Color3.new(1,1,1)
			})
			Create("UICorner", {CornerRadius = UDim.new(1,0), Parent = knob})

			local state = default or false
			switch.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					state = not state
					TweenService:Create(switch, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {BackgroundColor3 = state and Library.CurrentTheme.Accent or Library.CurrentTheme.Secondary}):Play()
					TweenService:Create(knob, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {Position = state and UDim2.new(1,-22,0.5,-10) or UDim2.new(0,2,0.5,-10)}):Play()
					if callback then callback(state) end
				end
			end)
			return toggleFrame
		end

		function tab:Slider(text, min, max, default, callback)
			local sliderFrame = Create("Frame", {
				Parent = container,
				Size = UDim2.new(1,0,0,60),
				BackgroundTransparency = 1
			})
			local label = Create("TextLabel", {
				Parent = sliderFrame,
				Size = UDim2.new(1,-100,0,25),
				Position = UDim2.new(0,10,0,0),
				Text = text,
				Font = Enum.Font.Gotham,
				TextSize = 16,
				TextColor3 = Library.CurrentTheme.Text,
				BackgroundTransparency = 1,
				TextXAlignment = Enum.TextXAlignment.Left
			})
			local valueLabel = Create("TextLabel", {
				Parent = sliderFrame,
				Size = UDim2.new(0,80,0,25),
				Position = UDim2.new(1,-90,0,0),
				Text = tostring(default or min),
				Font = Enum.Font.Gotham,
				TextSize = 16,
				TextColor3 = Library.CurrentTheme.Accent,
				BackgroundTransparency = 1,
				TextXAlignment = Enum.TextXAlignment.Right
			})
			local track = Create("Frame", {
				Parent = sliderFrame,
				Size = UDim2.new(1,-20,0,8),
				Position = UDim2.new(0,10,0,35),
				BackgroundColor3 = Library.CurrentTheme.Secondary
			})
			Create("UICorner", {CornerRadius = UDim.new(0,4), Parent = track})

			local fill = Create("Frame", {
				Name = "Accent",
				Parent = track,
				Size = UDim2.new(0,0,1,0),
				BackgroundColor3 = Library.CurrentTheme.Accent,
				AnchorPoint = Vector2.new(0,0.5),
				Position = UDim2.new(0,0,0.5,0)
			})
			Create("UICorner", {CornerRadius = UDim.new(0,4), Parent = fill})

			local knob = Create("Frame", {
				Parent = track,
				Size = UDim2.new(0,20,0,20),
				BackgroundColor3 = Color3.new(1,1,1),
				Position = UDim2.new(0,-10,0.5,-10),
				ZIndex = 5
			})
			Create("UICorner", {CornerRadius = UDim.new(1,0), Parent = knob})

			local value = default or min
			local function updateSlider(perc)
				value = math.floor(min + (max - min) * perc)
				valueLabel.Text = tostring(value)
				TweenService:Create(fill, TweenInfo.new(0.15, Enum.EasingStyle.Sine), {Size = UDim2.new(perc,0,1,0)}):Play()
				TweenService:Create(knob, TweenInfo.new(0.15, Enum.EasingStyle.Sine), {Position = UDim2.new(perc,-10,0.5,-10)}):Play()
				if callback then callback(value) end
			end

			local initialPerc = math.clamp((value - min) / (max - min), 0, 1)
			fill.Size = UDim2.new(initialPerc, 0, 1, 0)
			knob.Position = UDim2.new(initialPerc, -10, 0.5, -10)

			local dragging = false

			local function startDrag(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					dragging = true
				end
			end

			local function endDrag(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					dragging = false
				end
			end

			track.InputBegan:Connect(startDrag)
			knob.InputBegan:Connect(startDrag)
			UserInputService.InputEnded:Connect(endDrag)

			UserInputService.InputChanged:Connect(function(input)
				if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
					local relX = math.clamp((input.Position.X - track.AbsolutePosition.X) / track.AbsoluteSize.X, 0, 1)
					updateSlider(relX)
				end
			end)

			return sliderFrame
		end

		function tab:Dropdown(text, options, callback)
			local dropFrame = Create("Frame", {
				Parent = container,
				Size = UDim2.new(1,0,0,40),
				BackgroundColor3 = Library.CurrentTheme.Secondary,
				ClipsDescendants = true
			})
			Create("UICorner", {CornerRadius = UDim.new(0,8), Parent = dropFrame})
			Create("UIStroke", {Thickness = 1, Color = Library.CurrentTheme.Border, Parent = dropFrame})

			local label = Create("TextLabel", {
				Parent = dropFrame,
				Size = UDim2.new(1,-40,1,0),
				Text = text,
				Font = Enum.Font.Gotham,
				TextSize = 16,
				TextColor3 = Library.CurrentTheme.Text,
				BackgroundTransparency = 1,
				TextXAlignment = Enum.TextXAlignment.Left,
				Position = UDim2.new(0,10,0,0)
			})
			local arrow = Create("TextLabel", {
				Parent = dropFrame,
				Size = UDim2.new(0,30,1,0),
				Position = UDim2.new(1,-35,0,0),
				Text = "▼",
				Font = Enum.Font.Gotham,
				TextSize = 20,
				TextColor3 = Library.CurrentTheme.Text,
				BackgroundTransparency = 1
			})

			local list = Create("Frame", {
				Parent = container,
				Size = UDim2.new(1,0,0,#options*40),
				Position = UDim2.new(0,0,0,dropFrame.AbsolutePosition.Y - container.AbsolutePosition.Y + 45),
				BackgroundColor3 = Library.CurrentTheme.Secondary,
				Visible = false,
				ZIndex = 10
			})
			Create("UICorner", {CornerRadius = UDim.new(0,8), Parent = list})
			Create("UIStroke", {Thickness = 1, Color = Library.CurrentTheme.Border, Parent = list})
			Create("UIListLayout", {Parent = list, Padding = UDim.new(0,0), FillDirection = Enum.FillDirection.Vertical})

			local open = false
			dropFrame.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					open = not open
					list.Visible = open
					arrow.Text = open and "▲" or "▼"
				end
			end)

			for _, opt in ipairs(options) do
				local optBtn = Create("TextButton", {
					Parent = list,
					Size = UDim2.new(1,0,0,40),
					Text = opt,
					Font = Enum.Font.Gotham,
					TextSize = 16,
					TextColor3 = Library.CurrentTheme.Text,
					BackgroundTransparency = 1,
					ZIndex = 11
				})

				optBtn.MouseEnter:Connect(function()
					TweenService:Create(optBtn, TweenInfo.new(0.2), {BackgroundColor3 = Library.CurrentTheme.Accent, BackgroundTransparency = 0.7}):Play()
				end)
				optBtn.MouseLeave:Connect(function()
					TweenService:Create(optBtn, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
				end)

				optBtn.MouseButton1Click:Connect(function()
					label.Text = text .. " : " .. opt
					open = false
					list.Visible = false
					arrow.Text = "▼"
					if callback then callback(opt) end
				end)
			end

			return dropFrame
		end

		function tab:TextBox(text, placeholder, callback)
			local boxFrame = Create("Frame", {
				Parent = container,
				Size = UDim2.new(1,0,0,40),
				BackgroundTransparency = 1
			})
			local label = Create("TextLabel", {
				Parent = boxFrame,
				Size = UDim2.new(0,150,1,0),
				Text = text,
				Font = Enum.Font.Gotham,
				TextSize = 16,
				TextColor3 = Library.CurrentTheme.Text,
				BackgroundTransparency = 1,
				TextXAlignment = Enum.TextXAlignment.Left,
				Position = UDim2.new(0,10,0,0)
			})
			local box = Create("TextBox", {
				Parent = boxFrame,
				Size = UDim2.new(1,-170,0,34),
				Position = UDim2.new(0,160,0,3),
				PlaceholderText = placeholder,
				Font = Enum.Font.Gotham,
				TextSize = 16,
				TextColor3 = Library.CurrentTheme.Text,
				BackgroundColor3 = Library.CurrentTheme.Secondary,
				Text = ""
			})
			Create("UICorner", {CornerRadius = UDim.new(0,8), Parent = box})
			Create("UIStroke", {Thickness = 1, Color = Library.CurrentTheme.Border, Parent = box})

			box.FocusLost:Connect(function(enter)
				if enter and callback then callback(box.Text) end
			end)
			return boxFrame
		end

		return tab
	end

	local mainTab = Library:AddTab("Main")
	local settingsTab = Library:AddTab("Settings")

	settingsTab:Dropdown("Theme", {"Dark", "Light", "Purple", "Ocean", "Neon"}, function(themeName)
		Library.CurrentTheme = Library.Themes[themeName]
		ApplyTheme(windowGui)
	end)

	settingsTab:Dropdown("Font", {"Gotham", "GothamBold", "SourceSans", "SourceSansBold", "Roboto", "Ubuntu"}, function(fontName)
		Library.CurrentFont = Fonts[fontName]
		ApplyTheme(windowGui)
	end)

	return windowGui
end

function Library:Notify(data)
	local notifGui = Create("ScreenGui", {Parent = playerGui, ResetOnSpawn = false})
	local notif = Create("Frame", {
		Parent = notifGui,
		Size = UDim2.new(0,300,0,80),
		Position = UDim2.new(1,10,1,-90),
		BackgroundColor3 = Library.CurrentTheme.Background
	})
	Create("UICorner", {CornerRadius = UDim.new(0,12), Parent = notif})
	Create("UIStroke", {Thickness = 1.5, Color = Library.CurrentTheme.Border, Parent = notif})

	local title = Create("TextLabel", {
		Parent = notif,
		Size = UDim2.new(1,0,0,30),
		Position = UDim2.new(0,15,0,5),
		Text = data.Title or "Notification",
		Font = Enum.Font.GothamBold,
		TextSize = 18,
		TextColor3 = Library.CurrentTheme.Accent,
		BackgroundTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Left
	})
	local desc = Create("TextLabel", {
		Parent = notif,
		Size = UDim2.new(1,-20,0,30),
		Position = UDim2.new(0,10,0,35),
		Text = data.Text or "",
		Font = Enum.Font.Gotham,
		TextSize = 14,
		TextColor3 = Library.CurrentTheme.Text,
		BackgroundTransparency = 1,
		TextWrapped = true
	})

	TweenService:Create(notif, TweenInfo.new(0.4, Enum.EasingStyle.Quart), {Position = UDim2.new(1,-310,1,-90)}):Play()
	task.delay(data.Duration or 4, function()
		TweenService:Create(notif, TweenInfo.new(0.4, Enum.EasingStyle.Quart), {Position = UDim2.new(1,10,1,-90)}):Play()
		task.delay(0.4, function() notifGui:Destroy() end)
	end)
end

Library:CreateWindow("Fyor UI")

return Library
